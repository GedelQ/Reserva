-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.mesas (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  numero_mesa integer NOT NULL,
  capacidade integer NOT NULL,
  fileira integer NOT NULL,
  disponivel boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT mesas_pkey PRIMARY KEY (id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  full_name text,
  avatar_url text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id)
);
CREATE TABLE public.reservas (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone DEFAULT now(),
  id_mesa integer CHECK (id_mesa >= 1 AND id_mesa <= 98),
  data_reserva date NOT NULL,
  horario_reserva time without time zone NOT NULL,
  observacoes text DEFAULT ''::text,
  status text NOT NULL DEFAULT '''''''confirmada''''::text'''::text CHECK (status = ANY (ARRAY['ativa'::text, 'confirmada'::text, 'cancelada'::text, 'finalizada'::text, 'pendente'::text])),
  nome_cliente text NOT NULL,
  telefone_cliente text,
  id_mesa_historico smallint,
  numero_reserva bigint NOT NULL DEFAULT nextval('reservas_numero_reserva_seq'::regclass) UNIQUE,
  CONSTRAINT reservas_pkey PRIMARY KEY (id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  email text NOT NULL UNIQUE,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT users_pkey PRIMARY KEY (id)
);
CREATE TABLE public.webhook_config (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  endpoint_url text NOT NULL,
  enabled boolean DEFAULT false,
  secret_key text,
  events ARRAY DEFAULT ARRAY['reserva_criada'::text],
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT webhook_config_pkey PRIMARY KEY (id)
);
CREATE TABLE public.webhook_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  config_id uuid,
  event text NOT NULL,
  success boolean DEFAULT false,
  error_message text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT webhook_logs_pkey PRIMARY KEY (id),
  CONSTRAINT webhook_logs_config_id_fkey FOREIGN KEY (config_id) REFERENCES public.webhook_config(id)
);